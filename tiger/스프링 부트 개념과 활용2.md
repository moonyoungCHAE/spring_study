# 스프링 부트 개념과 활용2

## 독립적으로 실행 가능한 JAR

> 먼저 gradle를 설치한다.

우리는 `@SpringBootApplication`가 있는 main에서 실행시키는 방법으로 서버를 켰다. 

하지만 `JAR`파일 하나로 실행할 수도 있다.

- build.gradle

```
plugins {
    id 'org.springframework.boot' version '2.2.2.RELEASE'
    id 'io.spring.dependency-management' version '1.0.8.RELEASE'
    id 'java'
    id 'application' // 추가
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '1.8'

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    testImplementation('org.springframework.boot:spring-boot-starter-test') {
        exclude group: 'org.junit.vintage', module: 'junit-vintage-engine'
    }
}

test {
    useJUnitPlatform()
}

mainClassName = 'me.whiteship.Application' // 추가
```

`gradle bootjar`(Spring Boot만 가능한 명령어로 보임) 명령어를 입력하면 `build/libs`에 `jar`파일이 하나 생성된다. 그 경로로 들어가서 `java -jar 파일이름.jar`를 입력하면 서버가 실행된다.

**이유**는 생성한 `jar`파일안에 External Libraries에 있는 jar파일들이 전부 들어가 있기 때문에 가능하다고 한다.

MAINFEST.MF에서 이러한 작업으로 `jar`파일 하나로도 서버를 실행시킬 수 있는 것 같다.

- org.springframework.boot.loader.jar.JarFile을 사용해서 내장 JAR를 읽는다.
- org.springframework.boot.loader.Launcher를 사용해서 실행한다.

(자세한 설명은 이해 못함)

디버그 로그 찍기

Edit Configuratios에 들어가서 VM option에 -Ddebug 를 추가해준다.

## SpringApplication



## 외부설정

properties는 위치과 설정에 따라 우선 순위가 있다. 

우선순위에 있는 파일이 기존에 있는 것을 덮어쓴다.

application.properties의 내용을 가져와 사용할 수 있다.

- application.properties

  ```
  tiger.name = tiger
  tiger.age = ${random.int}
  tiger.fullName = ${tiger.name} Evan
  ```

- Sample.class

  ```java
  package me.whiteship;
  
  import org.springframework.beans.factory.annotation.Autowired;
  import org.springframework.boot.ApplicationArguments;
  import org.springframework.boot.ApplicationRunner;
  import org.springframework.stereotype.Component;
  
  @Component
  public class Sample implements ApplicationRunner {
  
      @Autowired
      TigerProperties tigerProperties;
  
      @Override
      public void run(ApplicationArguments args) throws Exception {
          System.out.println("===========");
          System.out.println(tigerProperties.getName());
          System.out.println(tigerProperties.getAge());
          System.out.println("===========");
      }
  }
  ```

- TigerProperties.class(getter, setter 필요)

  ```java
  package me.whiteship;
  
  import org.springframework.boot.context.properties.ConfigurationProperties;
  import org.springframework.stereotype.Component;
  
  @Component
  @ConfigurationProperties("tiger")
  public class TigerProperties {
      private String name;
      private int age;
      private String fullName;
  
      public String getName() {
          return name;
      }
  
      public int getAge() {
          return age;
      }
  
      public String getFullName() {
          return fullName;
      }
  
      public void setName(String name) {
          this.name = name;
      }
  
      public void setAge(int age) {
          this.age = age;
      }
  
      public void setFullName(String fullName) {
          this.fullName = fullName;
      }
  }
  ```

## 프로파일

@Profile 애노테이션은 어디에

- Base.class

  ```java
  package me.whiteship.config;
  
  import org.springframework.context.annotation.Bean;
  import org.springframework.context.annotation.Configuration;
  import org.springframework.context.annotation.Profile;
  
  @Profile("prod")
  @Configuration
  public class Base {
  
      @Bean
      public String hello() {
          return "hello";
      }
  }
  ```

- Test.class

  ```java
  package me.whiteship.config;
  
  import org.springframework.context.annotation.Bean;
  import org.springframework.context.annotation.Configuration;
  import org.springframework.context.annotation.Profile;
  
  @Profile("test")
  @Configuration
  public class Test {
  
      @Bean
      public String hello() {
          return "hello test";
      }
  }
  ```

- Sample.class

  ```java
  package me.whiteship;
  
  import org.springframework.beans.factory.annotation.Autowired;
  import org.springframework.boot.ApplicationArguments;
  import org.springframework.boot.ApplicationRunner;
  import org.springframework.stereotype.Component;
  
  
  @Component
  public class Sample implements ApplicationRunner {
  
      @Autowired
      private String hello;
  
      @Override
      public void run(ApplicationArguments args) throws Exception {
          System.out.println("===========");
          System.out.println(hello);
          System.out.println("===========");
      }
  }
  ```

- application.properties

  ```
  spring.profiles.active=prod // prod면 Base.class
  spring.profiles.active=test // test면 Test.class
  ```

  or

  application-prod.properties 또는 application-test.properties 가능하다. (application-{name}.properties)

application.properties에 `spring.profiles.include=prod`를 추가해서 application-prod.properties사용도 가능하다.

## 로깅

로깅 퍼사드 VS 로거

- Commons Logging, SLF4j (spring boot는 이것을 쓴다.)
- JUL, LOG4J2, Logback

application.properties

```
spring.output.ansi.enabled=always // 이쁘게 출력해 준다고 하는데 정확하지 않음
logging.path=logs // 저장되는 파일 경로
logging.level.me.whiteship=debug // debug로 된 아이들을 출력한다. (logger.debug(tigerProperties.getFullName()) // 이런 아이들 출력)
```



